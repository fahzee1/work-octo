/*
--------------------------------
Infinite Scroll
--------------------------------
+ https://github.com/paulirish/infinite-scroll
+ version 2.0b2.120519
+ Copyright 2011/12 Paul Irish & Luke Shumard
+ Licensed under the MIT license
+ Documentation: http://infinite-scroll.com/
*/(function(e,t,n){t.infinitescroll=function(e,n,r){this.element=t(r);this._create(e,n)||(this.failed=!0)};t.infinitescroll.defaults={loading:{finished:n,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:n},state:{isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,currPage:1},callback:n,debug:!1,behavior:n,binder:t(e),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:!1,pathParse:n,dataType:"html",appendCallback:!0,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:n,path:n};t.infinitescroll.prototype={_binding:function(e){var t=this,r=t.options;r.v="2.0b2.111027";if(r.behavior&&this["_binding_"+r.behavior]!==n)this["_binding_"+r.behavior].call(this);else{if("bind"!==e&&"unbind"!==e)return this._debug("Binding value "+e+" not valid"),!1;"unbind"==e?this.options.binder.unbind("smartscroll.infscr."+t.options.infid):this.options.binder[e]("smartscroll.infscr."+t.options.infid,function(){t.scroll()});this._debug("Binding",e)}},_create:function(e,r){var i=t.extend(!0,{},t.infinitescroll.defaults,e);if(!this._validate(e))return!1;this.options=i;var s=t(i.nextSelector).attr("href");if(!s)return this._debug("Navigation selector not found"),!1;i.path=this._determinepath(s);i.contentSelector=i.contentSelector||this.element;i.loading.selector=i.loading.selector||i.contentSelector;i.loading.msg=t('<div id="infscr-loading"><img alt="Loading..." src="'+i.loading.img+'" /><div>'+i.loading.msgText+"</div></div>");(new Image).src=i.loading.img;i.pixelsFromNavToBottom=t(document).height()-t(i.navSelector).offset().top;i.loading.start=i.loading.start||function(){t(i.navSelector).hide();i.loading.msg.appendTo(i.loading.selector).show(i.loading.speed,function(){beginAjax(i)})};i.loading.finished=i.loading.finished||function(){i.loading.msg.fadeOut("normal")};i.callback=function(e,s){i.behavior&&e["_callback_"+i.behavior]!==n&&e["_callback_"+i.behavior].call(t(i.contentSelector)[0],s);r&&r.call(t(i.contentSelector)[0],s,i)};this._setup();return!0},_debug:function(){if(this.options&&this.options.debug)return e.console&&console.log.call(console,arguments)},_determinepath:function(e){var t=this.options;if(!t.behavior||this["_determinepath_"+t.behavior]===n){if(t.pathParse)return this._debug("pathParse manual"),t.pathParse(e,this.options.state.currPage+1);if(e.match(/^(.*?)\b2\b(.*?$)/))e=e.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(e.match(/^(.*?)2(.*?$)/)){if(e.match(/^(.*?page=)2(\/.*|$)/))return e=e.match(/^(.*?page=)2(\/.*|$)/).slice(1);e=e.match(/^(.*?)2(.*?$)/).slice(1)}else{if(e.match(/^(.*?page=)1(\/.*|$)/))return e=e.match(/^(.*?page=)1(\/.*|$)/).slice(1);this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");t.state.isInvalidPage=!0}this._debug("determinePath",e);return e}this["_determinepath_"+t.behavior].call(this,e)},_error:function(e){var t=this.options;t.behavior&&this["_error_"+t.behavior]!==n?this["_error_"+t.behavior].call(this,e):("destroy"!==e&&"end"!==e&&(e="unknown"),this._debug("Error",e),"end"==e&&this._showdonemsg(),t.state.isDone=!0,t.state.currPage=1,t.state.isPaused=!1,this._binding("unbind"))},_loadcallback:function(r,i){var s=this.options,o=this.options.callback,u=s.state.isDone?"done":s.appendCallback?"append":"no-append";if(s.behavior&&this["_loadcallback_"+s.behavior]!==n)this["_loadcallback_"+s.behavior].call(this,r,i);else{switch(u){case"done":return this._showdonemsg(),!1;case"no-append":"html"==s.dataType&&(i=t("<div>"+i+"</div>").find(s.itemSelector));break;case"append":var a=r.children();if(0==a.length)return this._error("end");for(u=document.createDocumentFragment();r[0].firstChild;)u.appendChild(r[0].firstChild);this._debug("contentSelector",t(s.contentSelector)[0]);t(s.contentSelector)[0].appendChild(u);i=a.get()}s.loading.finished.call(t(s.contentSelector)[0],s);s.animate&&(u=t(e).scrollTop()+t("#infscr-loading").height()+s.extraScrollPx+"px",t("html,body").animate({scrollTop:u},800,function(){s.state.isDuringAjax=!1}));s.animate||(s.state.isDuringAjax=!1);o(this,i)}},_nearbottom:function(){var r=this.options,i=0+t(document).height()-r.binder.scrollTop()-t(e).height();if(r.behavior&&this["_nearbottom_"+r.behavior]!==n)return this["_nearbottom_"+r.behavior].call(this);this._debug("math:",i,r.pixelsFromNavToBottom);return i-r.bufferPx<r.pixelsFromNavToBottom},_pausing:function(e){var t=this.options;if(!t.behavior||this["_pausing_"+t.behavior]===n){"pause"!==e&&"resume"!==e&&null!==e&&this._debug("Invalid argument. Toggling pause value instead");switch(!e||"pause"!=e&&"resume"!=e?"toggle":e){case"pause":t.state.isPaused=!0;break;case"resume":t.state.isPaused=!1;break;case"toggle":t.state.isPaused=!t.state.isPaused}this._debug("Paused",t.state.isPaused);return!1}this["_pausing_"+t.behavior].call(this,e)},_setup:function(){var e=this.options;if(!e.behavior||this["_setup_"+e.behavior]===n)return this._binding("bind"),!1;this["_setup_"+e.behavior].call(this)},_showdonemsg:function(){var e=this.options;e.behavior&&this["_showdonemsg_"+e.behavior]!==n?this["_showdonemsg_"+e.behavior].call(this):(e.loading.msg.find("img").hide().parent().find("div").html(e.loading.finishedMsg).animate({opacity:1},2e3,function(){t(this).parent().fadeOut("normal")}),e.errorCallback.call(t(e.contentSelector)[0],"done"))},_validate:function(e){for(var n in e)if(n.indexOf&&-1<n.indexOf("Selector")&&0===t(e[n]).length)return this._debug("Your "+n+" found no elements."),!1;return!0},bind:function(){this._binding("bind")},destroy:function(){this.options.state.isDestroyed=!0;return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(e){var r=this,i=r.options,s=i.path,o,u,a,f,e=e||null;beginAjax=function(e){e.state.currPage++;r._debug("heading into ajax",s);o=t(e.contentSelector).is("table")?t("<tbody/>"):t("<div/>");u=s.join(e.state.currPage);a="html"==e.dataType||"json"==e.dataType?e.dataType:"html+callback";e.appendCallback&&"html"==e.dataType&&(a+="+callback");switch(a){case"html+callback":r._debug("Using HTML via .load() method");o.load(u+" "+e.itemSelector,null,function(e){r._loadcallback(o,e)});break;case"html":r._debug("Using "+a.toUpperCase()+" via $.ajax() method");t.ajax({url:u,dataType:e.dataType,complete:function(e,t){(f="undefined"!=typeof e.isResolved?e.isResolved():"success"===t||"notmodified"===t)?r._loadcallback(o,e.responseText):r._error("end")}});break;case"json":r._debug("Using "+a.toUpperCase()+" via $.ajax() method"),t.ajax({dataType:"json",type:"GET",url:u,success:function(t,i,s){f="undefined"!=typeof s.isResolved?s.isResolved():"success"===i||"notmodified"===i;e.appendCallback?e.template!=n?(t=e.template(t),o.append(t),f?r._loadcallback(o,t):r._error("end")):(r._debug("template must be defined."),r._error("end")):f?r._loadcallback(o,t):r._error("end")},error:function(){r._debug("JSON ajax request failed.");r._error("end")}})}};if(i.behavior&&this["retrieve_"+i.behavior]!==n)this["retrieve_"+i.behavior].call(this,e);else{if(i.state.isDestroyed)return this._debug("Instance is destroyed"),!1;i.state.isDuringAjax=!0;i.loading.start.call(t(i.contentSelector)[0],i)}},scroll:function(){var e=this.options,t=e.state;e.behavior&&this["scroll_"+e.behavior]!==n?this["scroll_"+e.behavior].call(this):!t.isDuringAjax&&!t.isInvalidPage&&!t.isDone&&!t.isDestroyed&&!t.isPaused&&this._nearbottom()&&this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))}};t.fn.infinitescroll=function(e,n){switch(typeof e){case"string":var r=Array.prototype.slice.call(arguments,1);this.each(function(){var n=t.data(this,"infinitescroll");if(!n||!t.isFunction(n[e])||"_"===e.charAt(0))return!1;n[e].apply(n,r)});break;case"object":this.each(function(){var r=t.data(this,"infinitescroll");r?r.update(e):(r=new t.infinitescroll(e,n,this),r.failed||t.data(this,"infinitescroll",r))})}return this};var r=t.event,i;r.special.smartscroll={setup:function(){t(this).bind("scroll",r.special.smartscroll.handler)},teardown:function(){t(this).unbind("scroll",r.special.smartscroll.handler)},handler:function(e,n){var r=this,s=arguments;e.type="smartscroll";i&&clearTimeout(i);i=setTimeout(function(){t.event.handle.apply(r,s)},"execAsap"===n?0:100)}};t.fn.smartscroll=function(e){return e?this.bind("smartscroll",e):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);