/**
 * jqBarGraph - jQuery plugin
 * @version: 1.1 (2011/04/03)
 * @requires jQuery v1.2.2 or later 
 * @author Ivan Lazarevic
 * Examples and documentation at: http://www.workshop.rs/jqbargraph/
 * 
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 * 
 */(function(e){function r(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}function s(e,t){return e[0]>t[0]?-1:e[0]<t[0]?1:0}var t=new Array,n=new Array;e.fn.jqBarGraph=e.fn.jqbargraph=function(n){init=function(r){t[r.id]=e.extend({},e.fn.jqBarGraph.defaults,n);e(r).css({width:t[r.id].width,height:t[r.id].height,position:"relative","text-align":"center"});doGraph(r)};sum=function(e){total=0;for(val in e)total+=e[val];return total.toFixed(2)};max=function(e){maxvalue=0;for(var t in e){value=e[t][0];value instanceof Array&&(value=sum(value));parseFloat(value)>parseFloat(maxvalue)&&(maxvalue=value)}return maxvalue};maxMulti=function(e){maxvalue=0;maxvalue2=0;for(var t in e){ar2=e[t][0];for(var n in ar2)ar2[n]>maxvalue2&&(maxvalue2=ar2[n]);maxvalue2>maxvalue&&(maxvalue=maxvalue2)}return maxvalue};doGraph=function(n){arr=t[n.id];data=arr.data;if(data==undefined){e(n).html("There is not enought data for graph");return}arr.sort=="asc"&&data.sort(r);arr.sort=="desc"&&data.sort(s);legend="";prefix=arr.prefix;postfix=arr.postfix;space=arr.barSpace;legendWidth=arr.legend?arr.legendWidth:0;fieldWidth=(e(n).width()-legendWidth)/data.length;totalHeight=e(n).height();var u=new Array;max=max(data);colPosition=0;for(var a in data){valueData=data[a][0];valueData instanceof Array?value=sum(valueData):value=valueData;lbl=data[a][1];color=data[a][2];unique=a+n.id;color==undefined&&arr.colors==0&&(color=arr.color);if(arr.colors&&!color){colorsCounter=arr.colors.length;colorsCounter==colPosition&&(colPosition=0);color=arr.colors[colPosition];colPosition++}arr.type=="multi"&&(color="none");lbl==undefined&&(lbl=arr.lbl);out="<div class='graphField"+n.id+"' id='graphField"+unique+"' style='position: absolute'>";out+="<div class='graphValue"+n.id+"' id='graphValue"+unique+"'>"+prefix+value+postfix+"</div>";out+="<div class='graphBar"+n.id+"' id='graphFieldBar"+unique+"' style='background-color:"+color+";position: relative; overflow: hidden;'></div>";if(!arr.legend||arr.legends)out+="<div class='graphLabel"+n.id+"' id='graphLabel"+unique+"'>"+lbl+"</div>";out+="</div>";e(n).append(out);totalHeightBar=totalHeight-e(".graphLabel"+n.id).height()-e(".graphValue"+n.id).height();fieldHeight=totalHeightBar*value/max;e("#graphField"+unique).css({left:fieldWidth*a,width:fieldWidth-space,"margin-left":space});if(valueData instanceof Array){if(arr.type=="multi"){maxe=maxMulti(data);totalHeightBar=fieldHeight=totalHeight-e(".graphLabel"+n.id).height();e(".graphValue"+n.id).remove()}else maxe=max;for(i in valueData){heig=totalHeightBar*valueData[i]/maxe;wid=parseInt((fieldWidth-space)/valueData.length);sv="";fs=0;if(arr.showValues){sv=arr.prefix+valueData[i]+arr.postfix;fs=12}o="<div class='subBars"+n.id+"' style='height:"+heig+"px; background-color: "+arr.colors[i]+"; left:"+wid*i+"px; color:"+arr.showValuesColor+"; font-size:"+fs+"px' >"+sv+"</div>";e("#graphFieldBar"+unique).prepend(o)}}arr.type=="multi"&&e(".subBars"+n.id).css({width:wid,position:"absolute",bottom:0});arr.position=="bottom"&&e(".graphField"+n.id).css("bottom",0);arr.legends||u.push([color,lbl,n.id,unique]);if(arr.animate){e("#graphFieldBar"+unique).css({height:0});e("#graphFieldBar"+unique).animate({height:fieldHeight},arr.speed*1e3)}else e("#graphFieldBar"+unique).css({height:fieldHeight})}for(var f in arr.legends)u.push([arr.colors[f],arr.legends[f],n.id,f]);createLegend(u);if(arr.legend){e(n).append("<div id='legendHolder"+unique+"'></div>");e("#legendHolder"+unique).css({width:legendWidth,"float":"right","text-align":"left"});e("#legendHolder"+unique).append(legend);e(".legendBar"+n.id).css({"float":"left",margin:3,height:12,width:20,"font-size":0})}if(arr.title){e(n).wrap("<div id='graphHolder"+unique+"'></div>");e("#graphHolder"+unique).prepend(arr.title).css({width:arr.width+"px","text-align":"center"})}};createLegend=function(e){legend="";for(var t in e){legend+="<div id='legend"+e[t][3]+"' style='overflow: hidden; zoom: 1;'>";legend+="<div class='legendBar"+e[t][2]+"' id='legendColor"+e[t][3]+"' style='background-color:"+e[t][0]+"'></div>";legend+="<div class='legendLabel"+e[t][2]+"' id='graphLabel"+unique+"'>"+e[t][1]+"</div>";legend+="</div>"}};this.each(function(){init(this)})};e.fn.jqBarGraph.defaults={barSpace:10,width:400,height:300,color:"#000000",colors:!1,lbl:"",sort:!1,position:"bottom",prefix:"",postfix:"",animate:!0,speed:1.5,legendWidth:100,legend:!1,legends:!1,type:!1,showValues:!0,showValuesColor:"#fff",title:!1}})(jQuery);