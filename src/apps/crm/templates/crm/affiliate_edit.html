{% extends "crm/base.html" %}

{% load sekizai_tags comments %}

{% block extra_sidebar %}
{% render_comment_list for affiliate %}
{% get_comment_form for affiliate as commentform %}
{% include "crm/_partials/comment_form.html" with form=commentform %}
{% endblock %}

{% block content %}
<form action="" method="POST">
{% csrf_token %}
<div class="row">
    <div class="span4">
        <fieldset>
            <legend>Affiliate Information</legend>
            {% include "crm/_partials/formfield.html" with field=form.agent_id %}
            {% include "crm/_partials/formfield.html" with field=form.name %}
            {% include "crm/_partials/formfield.html" with field=form.phone %}
            {% include "crm/_partials/formfield_checkbox.html" with field=form.has_landing_page %}        
            {% include "crm/_partials/formfield.html" with field=form.manager %}
        </fieldset>
        
    </div>
    <div class="span4">
        <fieldset>
            <legend>Additional Affiliate Information</legend>
            {% include "crm/_partials/formfield.html" with field=form.pixels %}
            {% include "crm/_partials/formfield.html" with field=form.conversion_pixels %}
        </fieldset>
    </div>
</div>
{% with profile=affiliate.profile_set.all.0 %}
{% if profile %}
<div class="row">
    <div class="span8 accordion" id="profiledata">
        <div class="accordion-group">
            <div class="accordion-heading">            
                <a class="accordion-toggle" href="#showdata" data-parent="#profiledata" data-toggle="collapse"> <i class="icon-chevron-right"></i> Affiliate Enrollemnt Information </a>
            </div>

            <div id="showdata" class="accordion-body collapse">
                <table class="table table-striped table-bordered table-condensed">
                    <tr>
                        <th width="20%">Name: </th><td>{{ profile.name }}</td>
                    </tr>
                    <tr>
                        <th>Title: </th><td>{{ profile.title }}</td>
                    </tr>
                    <tr>
                        <th>Company Name: </th><td>{{ profile.company_name }}</td>
                    </tr>
                    <tr>
                        <th>Tax ID: </th><td>{{ profile.taxid }}</td>
                    </tr>
                    <tr>
                        <th>Street Address: </th><td>{{ profile.street_address }}</td>
                    </tr>
                    <tr>
                        <th>City: </th><td>{{ profile.city }}</td>
                    </tr>
                    <tr>
                        <th>State: </th><td>{{ profile.state }}</td>
                    </tr>
                    <tr>
                        <th>Zipcode: </th><td>{{ profile.zipcode }}</td>
                    </tr>
                    <tr>
                        <th>Phone: </th><td>{{ profile.phone }}</td>
                    </tr>
                    <tr>
                        <th>Fax: </th><td>{{ profile.fax }}</td>
                    </tr>
                    <tr>
                        <th>Email: </th><td>{{ profile.email }}</td>
                    </tr>
                    <tr>
                        <th>Website: </th><td>{{ profile.website }}</td>
                    </tr>
                    <tr>
                        <th>Comments: </th><td>{{ profile.comments }}</td>
                    </tr>

                </table> 
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endwith %}
<div class="row">
    <div class="span8">
        <div class="form-actions">
            <button class="btn btn-success" type="submit">Save changes</button>
            <a href="{% url crm:affiliates %}" class="btn">Cancel</a>
            <button class="btn btn-danger" id='delete-btn' style="float: right;">Delete</button>
        </div>
    </div>
</div>
</form>
<div class="modal hide fade" id="delete_confirm">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">Ã—</button>
        <h3>Are you sure... ?</h3>
    </div>
    <div class="modal-body">
        <p>Deleting this affiliate will be permanent and cannot be undone!!!</p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Close</a>
        <a href="{% url crm:affiliates_delete affiliate.id %}" class="btn btn-danger">Confirm Deletion</a>
    </div>
</div>
{% addtoblock "js" %}
<script type='text/javascript'>
$(document).ready(function() {
    $('#delete-btn').click(function(e) {
        e.preventDefault();
        $('#delete_confirm').modal('show');
    });
    $('.typeahead').typeahead({
        'src': {{ typeahead_src }}
    })
});
</script>
{% endaddtoblock %}
{% endblock %}