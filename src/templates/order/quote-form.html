{% load sekizai_tags %}
<form id="quote-form" method="post" action="">
    {% csrf_token %}
	<div>
		<p>Free Security Quote</p>
		<label>Name</label>
        {{ form.name }}

		<label>Email</label>
        {{ form.email }}
		
        <label>Phone Number</label>
        {{ form.phone }}


	</div>
	<button type="button" class="redbutton">Get Quote ></button>

    <a href="http://www.protectamerica.com/pa/priv_p" title="View our Privacy Policy">We never share your information with anyone</a>
    <div id="quote-form-error">
        <img src="{{ STATIC_URL }}/img/base/error-arrow.png" id="error-arrow" />
        <strong>Whoops!</strong>
        <ul></ul>
    </div>
    <div id="third-party">
    {% comment %}
        <table width="135" border="0" cellpadding="2" cellspacing="0" title="Click to Verify - This site chose VeriSign Trust Seal to promote trust online with consumers.">
        <tr>
        <td width="135" align="center" valign="top"><script type="text/javascript" src="https://seal.verisign.com/getseal?host_name=protectamerica.com&amp;size=S&amp;use_flash=NO&amp;use_transparent=NO&amp;lang=en"></script>
        <a href="http://www.verisign.com/verisign-trust-seal" target="_blank"  style="color:#000000; text-decoration:none; font:bold 7px verdana,sans-serif; letter-spacing:.5px; text-align:center; margin:0px; padding:0px;">ABOUT TRUST ONLINE</a></td>
        </tr>
        </table>
    {% endcomment %}
    {% comment %}
    <!-- START SCANALERT CODE -->
    <a target="_blank" href="https://www.mcafeesecure.com/RatingVerify?ref=www.protectamerica.com"><img width="115" height="32" border="0" src="//images.scanalert.com/meter/www.protectamerica.com/12.gif" alt="McAfee SECURE sites help keep you safe from identity theft, credit card fraud, spyware, spam, viruses and online scams" oncontextmenu="alert('Copying Prohibited by Law - McAfee SECURE is a Trademark of McAfee, Inc.'); return false;"></a>
    <!-- END SCANALERT CODE -->
    {% endcomment %}
    {% comment %}
    <div id="4d9e197b-b560-4855-8a81-060da2587fb0"> <script type="text/javascript" src="//privacy-policy.truste.com/privacy-seal/Protect-America,-Inc-/asc?rid=4d9e197b-b560-4855-8a81-060da2587fb0"></script><a href="//privacy.truste.com/privacy-seal/Protect-America,-Inc-/validation?rid=a32fda55-5b8a-4a07-b143-f23589641269" title="TRUSTe online privacy certification" target="_blank"><img style="border: none" src="//privacy-policy.truste.com/privacy-seal/Protect-America,-Inc-/seal?rid=a32fda55-5b8a-4a07-b143-f23589641269" alt="TRUSTe online privacy certification"/></a></div>
    {% endcomment %}
    </div>
</form>
{% addtoblock "js" %}
<script type="text/javascript">
$(document).ready(function() {
    $('#quote-form input').keypress(function(e){
        if(e.which == 13){
            $('#quote-form button').click();
        }
    });
    var submitting = false;

    $('#quote-form button').click(function() {
        console.log(submitting);
        if(submitting==true) {
            return false;
        }
        submitting = true;
        $('#quote-form div').removeClass('.error-state');
        var data = {'name': $('#id_name').val(), 'email': $('#id_email').val(), 'phone': $('#id_phone').val(), 'form': 'basic'}
        $.ajax({
            type: "POST",
            url: "/contact/ajaxpost/",
            data: data,
            dataType: "json",
            success: newFormSuccess
        });

        function newFormSuccess(json) {
            submitting = false;
            if(json.success) {
                window.location = "http://www.protectamerica.com/pa/thank_you";
            }
        if(json.errors) {
            $("#quote-form-error").show();
            $("#quote-form-error ul").html("");
            var error_string = "";
            if(typeof json.errors == "object") { //this is an array of error messages
                $.each(json.errors, function(k,v) {
                    switch(k) {
                        case 'phone':
                            error_string += "<li> Phone: "+v+"</li>";
                            break;
                        case 'email':
                            error_string += "<li> Email: "+v+"</li>";
                            break;
                        case 'name':
                            error_string += "<li> Name: "+v+"</li>";
                            break;
                        default:
                            error_string += "<li>"+v+"</li>";
                            break;
                    }
                });
            } else {
                error_string = "<li>"+json.errors+"</li>\n";
            }
            
            $("#quote-form-error ul").html(error_string);
            } else $("#quote-form-error").hide();

        }
        return false;
        });
    }); 
</script>
{% endaddtoblock "js" %}
