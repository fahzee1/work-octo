// Inserts shortcut buttons after all of the following:
//     <input type="text" class="vDateField">
//     <input type="text" class="vTimeField">
var DateTimeShortcuts={calendars:[],calendarInputs:[],clockInputs:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",shortCutsClass:"datetimeshortcuts",admin_media_prefix:"",init:function(){window.__admin_media_prefix__!=undefined?DateTimeShortcuts.admin_media_prefix=window.__admin_media_prefix__:DateTimeShortcuts.admin_media_prefix="/missing-admin-media-prefix/";var e=document.getElementsByTagName("input");for(i=0;i<e.length;i++){var t=e[i];t.getAttribute("type")=="text"&&t.className.match(/vTimeField/)?DateTimeShortcuts.addClock(t):t.getAttribute("type")=="text"&&t.className.match(/vDateField/)&&DateTimeShortcuts.addCalendar(t)}},addClock:function(e){var t=DateTimeShortcuts.clockInputs.length;DateTimeShortcuts.clockInputs[t]=e;var n=document.createElement("span");n.className=DateTimeShortcuts.shortCutsClass;e.parentNode.insertBefore(n,e.nextSibling);var r=document.createElement("a");r.setAttribute("href","javascript:DateTimeShortcuts.handleClockQuicklink("+t+", new Date().strftime('"+get_format("TIME_INPUT_FORMATS")[0]+"'));");r.appendChild(document.createTextNode(gettext("Now")));var i=document.createElement("a");i.setAttribute("href","javascript:DateTimeShortcuts.openClock("+t+");");i.id=DateTimeShortcuts.clockLinkName+t;quickElement("img",i,"","src",DateTimeShortcuts.admin_media_prefix+"img/admin/icon_clock.gif","alt",gettext("Clock"));n.appendChild(document.createTextNode(" "));n.appendChild(r);n.appendChild(document.createTextNode(" | "));n.appendChild(i);var s=document.createElement("div");s.style.display="none";s.style.position="absolute";s.className="clockbox module";s.setAttribute("id",DateTimeShortcuts.clockDivName+t);document.body.appendChild(s);addEvent(s,"click",DateTimeShortcuts.cancelEventPropagation);quickElement("h2",s,gettext("Choose a time"));time_list=quickElement("ul",s,"");time_list.className="timelist";time_format=get_format("TIME_INPUT_FORMATS")[0];quickElement("a",quickElement("li",time_list,""),gettext("Now"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+t+", new Date().strftime('"+time_format+"'));");quickElement("a",quickElement("li",time_list,""),gettext("Midnight"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+t+", new Date(1970,1,1,0,0,0,0).strftime('"+time_format+"'));");quickElement("a",quickElement("li",time_list,""),gettext("6 a.m."),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+t+", new Date(1970,1,1,6,0,0,0).strftime('"+time_format+"'));");quickElement("a",quickElement("li",time_list,""),gettext("Noon"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+t+", new Date(1970,1,1,12,0,0,0).strftime('"+time_format+"'));");cancel_p=quickElement("p",s,"");cancel_p.className="calendar-cancel";quickElement("a",cancel_p,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissClock("+t+");")},openClock:function(e){var t=document.getElementById(DateTimeShortcuts.clockDivName+e),n=document.getElementById(DateTimeShortcuts.clockLinkName+e);getStyle(document.body,"direction")!="rtl"?t.style.left=findPosX(n)+17+"px":t.style.left=findPosX(n)-110+"px";t.style.top=Math.max(0,findPosY(n)-30)+"px";t.style.display="block";addEvent(window.document,"click",function(){DateTimeShortcuts.dismissClock(e);return!0})},dismissClock:function(e){document.getElementById(DateTimeShortcuts.clockDivName+e).style.display="none";window.document.onclick=null},handleClockQuicklink:function(e,t){DateTimeShortcuts.clockInputs[e].value=t;DateTimeShortcuts.clockInputs[e].focus();DateTimeShortcuts.dismissClock(e)},addCalendar:function(e){var t=DateTimeShortcuts.calendars.length;DateTimeShortcuts.calendarInputs[t]=e;var n=document.createElement("span");n.className=DateTimeShortcuts.shortCutsClass;e.parentNode.insertBefore(n,e.nextSibling);var r=document.createElement("a");r.setAttribute("href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+t+", 0);");r.appendChild(document.createTextNode(gettext("Today")));var i=document.createElement("a");i.setAttribute("href","javascript:DateTimeShortcuts.openCalendar("+t+");");i.id=DateTimeShortcuts.calendarLinkName+t;quickElement("img",i,"","src",DateTimeShortcuts.admin_media_prefix+"img/admin/icon_calendar.gif","alt",gettext("Calendar"));n.appendChild(document.createTextNode(" "));n.appendChild(r);n.appendChild(document.createTextNode(" | "));n.appendChild(i);var s=document.createElement("div");s.style.display="none";s.style.position="absolute";s.className="calendarbox module";s.setAttribute("id",DateTimeShortcuts.calendarDivName1+t);document.body.appendChild(s);addEvent(s,"click",DateTimeShortcuts.cancelEventPropagation);var o=quickElement("div",s,""),u=quickElement("a",o,"<","href","javascript:DateTimeShortcuts.drawPrev("+t+");");u.className="calendarnav-previous";var a=quickElement("a",o,">","href","javascript:DateTimeShortcuts.drawNext("+t+");");a.className="calendarnav-next";var f=quickElement("div",s,"","id",DateTimeShortcuts.calendarDivName2+t);f.className="calendar";DateTimeShortcuts.calendars[t]=new Calendar(DateTimeShortcuts.calendarDivName2+t,DateTimeShortcuts.handleCalendarCallback(t));DateTimeShortcuts.calendars[t].drawCurrent();var l=quickElement("div",s,"");l.className="calendar-shortcuts";quickElement("a",l,gettext("Yesterday"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+t+", -1);");l.appendChild(document.createTextNode(" | "));quickElement("a",l,gettext("Today"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+t+", 0);");l.appendChild(document.createTextNode(" | "));quickElement("a",l,gettext("Tomorrow"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+t+", +1);");var c=quickElement("p",s,"");c.className="calendar-cancel";quickElement("a",c,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissCalendar("+t+");")},openCalendar:function(e){var t=document.getElementById(DateTimeShortcuts.calendarDivName1+e),n=document.getElementById(DateTimeShortcuts.calendarLinkName+e),r=DateTimeShortcuts.calendarInputs[e];if(r.value){var i=r.value.split("-"),s=i[0],o=parseFloat(i[1]);s.match(/\d\d\d\d/)&&o>=1&&o<=12&&DateTimeShortcuts.calendars[e].drawDate(o,s)}getStyle(document.body,"direction")!="rtl"?t.style.left=findPosX(n)+17+"px":t.style.left=findPosX(n)-180+"px";t.style.top=Math.max(0,findPosY(n)-75)+"px";t.style.display="block";addEvent(window.document,"click",function(){DateTimeShortcuts.dismissCalendar(e);return!0})},dismissCalendar:function(e){document.getElementById(DateTimeShortcuts.calendarDivName1+e).style.display="none";window.document.onclick=null},drawPrev:function(e){DateTimeShortcuts.calendars[e].drawPreviousMonth()},drawNext:function(e){DateTimeShortcuts.calendars[e].drawNextMonth()},handleCalendarCallback:function(e){format=get_format("DATE_INPUT_FORMATS")[0];format=format.replace("\\","\\\\");format=format.replace("\r","\\r");format=format.replace("\n","\\n");format=format.replace("	","\\t");format=format.replace("'","\\'");return["function(y, m, d) { DateTimeShortcuts.calendarInputs[",e,"].value = new Date(y, m-1, d).strftime('",format,"');DateTimeShortcuts.calendarInputs[",e,"].focus();document.getElementById(DateTimeShortcuts.calendarDivName1+",e,").style.display='none';}"].join("")},handleCalendarQuickLink:function(e,t){var n=new Date;n.setDate(n.getDate()+t);DateTimeShortcuts.calendarInputs[e].value=n.strftime(get_format("DATE_INPUT_FORMATS")[0]);DateTimeShortcuts.calendarInputs[e].focus();DateTimeShortcuts.dismissCalendar(e)},cancelEventPropagation:function(e){e||(e=window.event);e.cancelBubble=!0;e.stopPropagation&&e.stopPropagation()}};addEvent(window,"load",DateTimeShortcuts.init);