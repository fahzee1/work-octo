/* 'Magic' date parsing, by Simon Willison (6th October 2003)
   http://simon.incutio.com/archive/2003/10/06/betterDateInput
   Adapted for 6newslawrence.com, 28th January 2004
*//* Finds the index of the first occurence of item in the array, or -1 if not found */function parseMonth(e){var t=monthNames.filter(function(t){return(new RegExp("^"+e,"i")).test(t)});if(t.length==0)throw new Error("Invalid month string");if(t.length>1)throw new Error("Ambiguous month");return monthNames.indexOf(t[0])}function parseWeekday(e){var t=weekdayNames.filter(function(t){return(new RegExp("^"+e,"i")).test(t)});if(t.length==0)throw new Error("Invalid day string");if(t.length>1)throw new Error("Ambiguous weekday");return weekdayNames.indexOf(t[0])}function parseDateString(e){for(var t=0;t<dateParsePatterns.length;t++){var n=dateParsePatterns[t].re,r=dateParsePatterns[t].handler,i=n.exec(e);if(i)return r(i)}throw new Error("Invalid date string")}function fmt00(e){Math.abs(parseInt(e))<10&&(e="0"+Math.abs(e));return e}function parseDateStringISO(e){try{var t=parseDateString(e);return t.getFullYear()+"-"+fmt00(t.getMonth()+1)+"-"+fmt00(t.getDate())}catch(n){return e}}function magicDate(e){var t=e.id+"Msg";try{var n=parseDateString(e.value);e.value=n.getFullYear()+"-"+fmt00(n.getMonth()+1)+"-"+fmt00(n.getDate());e.className="";if(document.getElementById(t)){document.getElementById(t).firstChild.nodeValue=n.toDateString();document.getElementById(t).className="normal"}}catch(r){e.className="error";var i=r.message;i.indexOf("is null or not an object")>-1&&(i="Invalid date string");if(document.getElementById(t)){document.getElementById(t).firstChild.nodeValue=i;document.getElementById(t).className="error"}}}typeof Array.prototype.indexOf=="undefined"&&(Array.prototype.indexOf=function(e){var t=this.length;for(var n=0;n<t;n++)if(this[n]==e)return n;return-1});typeof Array.prototype.filter=="undefined"&&(Array.prototype.filter=function(e){var t=[],n=this.length;for(var r=0;r<n;r++)e(this[r])&&(t[t.length]=this[r]);return t});var monthNames=gettext("January February March April May June July August September October November December").split(" "),weekdayNames=gettext("Sunday Monday Tuesday Wednesday Thursday Friday Saturday").split(" "),dateParsePatterns=[{re:/^tod/i,handler:function(){return new Date}},{re:/^tom/i,handler:function(){var e=new Date;e.setDate(e.getDate()+1);return e}},{re:/^yes/i,handler:function(){var e=new Date;e.setDate(e.getDate()-1);return e}},{re:/^(\d{1,2})(st|nd|rd|th)?$/i,handler:function(e){var t=new Date;t.setDate(parseInt(e[1],10));return t}},{re:/^(\d{1,2})(?:st|nd|rd|th)? (\w+)$/i,handler:function(e){var t=new Date;t.setDate(1);t.setMonth(parseMonth(e[2]));t.setDate(parseInt(e[1],10));return t}},{re:/^(\d{1,2})(?:st|nd|rd|th)? (\w+),? (\d{4})$/i,handler:function(e){var t=new Date;t.setDate(1);t.setYear(e[3]);t.setMonth(parseMonth(e[2]));t.setDate(parseInt(e[1],10));return t}},{re:/^(\w+) (\d{1,2})(?:st|nd|rd|th)?$/i,handler:function(e){var t=new Date;t.setDate(1);t.setMonth(parseMonth(e[1]));t.setDate(parseInt(e[2],10));return t}},{re:/^(\w+) (\d{1,2})(?:st|nd|rd|th)?,? (\d{4})$/i,handler:function(e){var t=new Date;t.setDate(1);t.setYear(e[3]);t.setMonth(parseMonth(e[1]));t.setDate(parseInt(e[2],10));return t}},{re:/^next (\w+)$/i,handler:function(e){var t=new Date,n=t.getDay(),r=parseWeekday(e[1]),i=r-n;r<=n&&(i+=7);t.setDate(t.getDate()+i);return t}},{re:/^last (\w+)$/i,handler:function(e){throw new Error("Not yet implemented")}},{re:/(\d{1,2})\/(\d{1,2})\/(\d{4})/,handler:function(e){var t=new Date;t.setDate(1);t.setYear(e[3]);t.setMonth(parseInt(e[1],10)-1);t.setDate(parseInt(e[2],10));return t}},{re:/(\d{4})-(\d{1,2})-(\d{1,2})/,handler:function(e){var t=new Date;t.setDate(1);t.setYear(parseInt(e[1]));t.setMonth(parseInt(e[2],10)-1);t.setDate(parseInt(e[3],10));return t}}];