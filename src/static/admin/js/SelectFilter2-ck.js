/*
SelectFilter2 - Turns a multiple-select box into a filter interface.

Different than SelectFilter because this is coupled to the admin framework.

Requires core.js, SelectBox.js and addevent.js.
*/function findForm(e){return e.tagName.toLowerCase()!="form"?findForm(e.parentNode):e}var SelectFilter={init:function(e,t,n,r){if(e.match(/__prefix__/))return;var i=document.getElementById(e);i.id+="_from";i.className="filtered";var s=i.parentNode.getElementsByTagName("p");for(var o=0;o<s.length;o++)s[o].className.indexOf("info")!=-1?i.parentNode.removeChild(s[o]):s[o].className.indexOf("help")!=-1&&i.parentNode.insertBefore(s[o],i.parentNode.firstChild);var u=quickElement("div",i.parentNode);u.className=n?"selector stacked":"selector";var a=quickElement("div",u,"");a.className="selector-available";quickElement("h2",a,interpolate(gettext("Available %s"),[t]));var f=quickElement("p",a,"");f.className="selector-filter";var l=quickElement("label",f,"","for",e+"_input","style","width:16px;padding:2px"),c=quickElement("img",l,"","src",r+"img/admin/selector-search.gif");c.alt=gettext("Filter");f.appendChild(document.createTextNode(" "));var h=quickElement("input",f,"","type","text");h.id=e+"_input";a.appendChild(i);var p=quickElement("a",a,gettext("Choose all"),"href",'javascript: (function(){ SelectBox.move_all("'+e+'_from", "'+e+'_to"); })()');p.className="selector-chooseall";var d=quickElement("ul",u,"");d.className="selector-chooser";var v=quickElement("a",quickElement("li",d,""),gettext("Add"),"href",'javascript: (function(){ SelectBox.move("'+e+'_from","'+e+'_to");})()');v.className="selector-add";var m=quickElement("a",quickElement("li",d,""),gettext("Remove"),"href",'javascript: (function(){ SelectBox.move("'+e+'_to","'+e+'_from");})()');m.className="selector-remove";var g=quickElement("div",u,"");g.className="selector-chosen";quickElement("h2",g,interpolate(gettext("Chosen %s"),[t]));var y=quickElement("p",g,gettext("Select your choice(s) and click "));y.className="selector-filter";quickElement("img",y,"","src",r+(n?"img/admin/selector_stacked-add.gif":"img/admin/selector-add.gif"),"alt","Add");var b=quickElement("select",g,"","id",e+"_to","multiple","multiple","size",i.size,"name",i.getAttribute("name"));b.className="filtered";var w=quickElement("a",g,gettext("Clear all"),"href",'javascript: (function() { SelectBox.move_all("'+e+'_to", "'+e+'_from");})()');w.className="selector-clearall";i.setAttribute("name",i.getAttribute("name")+"_old");addEvent(h,"keyup",function(t){SelectFilter.filter_key_up(t,e)});addEvent(h,"keydown",function(t){SelectFilter.filter_key_down(t,e)});addEvent(i,"dblclick",function(){SelectBox.move(e+"_from",e+"_to")});addEvent(b,"dblclick",function(){SelectBox.move(e+"_to",e+"_from")});addEvent(findForm(i),"submit",function(){SelectBox.select_all(e+"_to")});SelectBox.init(e+"_from");SelectBox.init(e+"_to");SelectBox.move(e+"_from",e+"_to")},filter_key_up:function(e,t){from=document.getElementById(t+"_from");if(e.which&&e.which==13||e.keyCode&&e.keyCode==13){from.selectedIndex=0;SelectBox.move(t+"_from",t+"_to");from.selectedIndex=0;return!1}var n=from.selectedIndex;SelectBox.filter(t+"_from",document.getElementById(t+"_input").value);from.selectedIndex=n;return!0},filter_key_down:function(e,t){from=document.getElementById(t+"_from");if(e.which&&e.which==39||e.keyCode&&e.keyCode==39){var n=from.selectedIndex;SelectBox.move(t+"_from",t+"_to");from.selectedIndex=n==from.length?from.length-1:n;return!1}if(e.which&&e.which==40||e.keyCode&&e.keyCode==40)from.selectedIndex=from.length==from.selectedIndex+1?0:from.selectedIndex+1;if(e.which&&e.which==38||e.keyCode&&e.keyCode==38)from.selectedIndex=from.selectedIndex==0?from.length-1:from.selectedIndex-1;return!0}};